let gyt=null;function showMsg(t){const e=document.getElementById("msg");e.textContent="",e.insertAdjacentHTML("afterbegin",t),e.hidden=!1,document.getElementById("idPlayer").hidden=!0}window.addEventListener("message",(t=>{const e=t.data.m,a=t.data?.ifId||null;switch(e){case"state":gyt.ytPlayState();break;case"togglePlay":gyt.ytTogglePlay();break;case"play":gyt.ytPlay();break;case"pause":gyt.ytPause();break;case"stop":gyt.ytStop();break;case"rateup":case"ratedown":{const t=gyt.ytGetRate()+("rateup"==e?.25:-.25);gyt.ytRate({rate:t})}break;case"rate":{const e=parseFloat(t.data.rate)||1;gyt.ytRate({rate:e})}break;case"sendRate":{const t=gyt.ytGetRate().toFixed(2);window.parent.postMessage({ifId:a,m:"sendRate",rate:t},"*")}break;case"forward":case"backward":{let t="forward"==e?3:-3;const a=gyt.ytGetRate();a<1&&(t=Number((t*a).toFixed(2))),gyt.ytSeek({sec:t})}break}}));class YT_c{constructor({vId:t,ifId:e,bAuto:a=!1}){this._player=null,this.loadYTVid({vId:t,ifId:e,bAuto:a})}ytPlay(){this._player?.playVideo()}ytPause(){this._player?.pauseVideo()}ytStop(){this._player?.stopVideo()}ytPlayState(){const t=this._player?.getPlayerState();return 1==t||3==t}ytTogglePlay(){if(!this._player?.getPlayerState)return!1;const t=this._player.getPlayerState();return 1==t||3==t?(this._player?.pauseVideo(),!0):(this._player?.playVideo(),!1)}ytRate({rate:t}){(t=Number(parseFloat(t).toFixed(2)))<.1?t=.1:t>4&&(t=4),this._player?.setPlaybackRate(t)}ytGetRate(){return parseFloat(this._player?.getPlaybackRate())||1}ytDuration(){return this._player?.getDuration()||0}ytCurTime(){return this._player?.getCurrentTime()||0}ytSeek({sec:t}){t=Number(parseFloat(t).toFixed(2)),isNaN(t)&&(t=0);const e=this.ytDuration();let a=this.ytCurTime();a+=t,a<0?a=0:e>0&&a>e&&(a=e-1),this._player?.seekTo(a,!0)}loadYTVid({vId:t,ifId:e,bAuto:a=!1}){this._player=new YT.Player("idPlayer",{videoId:t,playerVars:{controls:1,rel:0,playsinline:1,iv_load_policy:3,autoplay:a?1:0,mute:0,rel:0},events:{onReady:t=>{},onStateChange:t=>{const a=t.data;a==YT.PlayerState.ENDED&&(this.sendMsg({tp:"nextVideo",ifId:e}),this.ytSeek({sec:0}),this.ytPlay()),a==YT.PlayerState.PLAYING||a==YT.PlayerState.BUFFERING?this.sendMsg({tp:"playing",ifId:e}):this.sendMsg({tp:"paused",ifId:e})},onError:t=>{t.data;this.sendMsg({tp:"error",ifId:e})}}})}sendMsg({tp:t,ifId:e}){window.parent.postMessage({m:"yt_"+t,ifId:e},"*")}}function onYouTubeIframeAPIReady(){const t=new URLSearchParams(location.search),e=t.get("v"),a=t.get("ifId"),s="1"==t.get("auto");if(!e||!a)return;/^[A-Za-z0-9_-]{11}$/.test(e)?gyt=new YT_c({vId:e,ifId:a,bAuto:s}):showMsg("不正な動画IDです。<br>11文字の YouTube 動画IDを指定してください。<br>例: <code>dQw4w9WgXcQ</code>")}